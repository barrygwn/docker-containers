#!/bin/bash
# vim:set ft=sh sw=2 sts=2 st=2 et:
set -e

# Global variables required
APP_UID=${APP_UID:-1000}
APP_GID=${APP_GID:-1000}
APP_USER=${APP_USER:-appuser}
HOME=/home/$APP_USER


if [ ! -f "/home/${APP_USER}/.oscrc" ]; then
	echo "Setting up osc..."
	cat <<-EOF > /home/${APP_USER}/.oscrc
	[general]
	apiurl = https://api.opensuse.org
	use_keyring = 1
	EOF
	chown $APP_UID:$APP_GID /home/${APP_USER}/.oscrc
	s6-applyuidgid -u $APP_UID -g $APP_GID /usr/bin/osc $@
	if [ -f "/home/${APP_USER}/.oscrc" ]; then
		s6-applyuidgid -u $APP_UID -g $APP_GID cp /home/${APP_USER}/.oscrc /home/${APP_USER}/target/.oscrc
		echo "Done!"
	fi
else
  cd ${TARGET_DIR}
  s6-applyuidgid -u $APP_UID -g $APP_GID /usr/bin/osc $@
fi

